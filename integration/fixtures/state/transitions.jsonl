{"case_id": "ENTRY_BASIC", "description": "Basic entry - check exposure increases", "initial_bankroll": 10000.0, "params": {"max_daily_loss_usd": 500.0}, "events": [{"event_type": "entry", "signal_id": "SIG001", "token_mint": "SOL123", "wallet_address": "WalletA", "size_usd": 1000.0, "fill_price": 0.0002, "ts": 1000}], "expected": {"bankroll_usd": 9000.0, "open_position_count": 1, "exposure_by_token": {"SOL123": 1000.0}, "cooldown_active": false}}
{"case_id": "EXIT_PROFIT", "description": "Exit with profit - check PnL accumulates", "initial_bankroll": 10000.0, "params": {"max_daily_loss_usd": 500.0}, "events": [{"event_type": "entry", "signal_id": "SIG001", "token_mint": "SOL123", "wallet_address": "WalletA", "size_usd": 1000.0, "fill_price": 0.0002, "ts": 1000}, {"event_type": "exit", "signal_id": "SIG001", "token_mint": "SOL123", "wallet_address": "WalletA", "exit_price": 0.00025, "pnl_usd": 250.0, "ts": 1001}], "expected": {"bankroll_usd": 10250.0, "daily_pnl_usd": 250.0, "open_position_count": 0, "exposure_by_token": {}, "cooldown_active": false}}
{"case_id": "EXIT_LOSS_TRIGGER_COOLDOWN", "description": "Exit with loss exceeding daily limit - cooldown activates", "initial_bankroll": 10000.0, "params": {"max_daily_loss_usd": 500.0}, "events": [{"event_type": "entry", "signal_id": "SIG001", "token_mint": "RAY456", "wallet_address": "WalletB", "size_usd": 1000.0, "fill_price": 0.001, "ts": 1000}, {"event_type": "exit", "signal_id": "SIG001", "token_mint": "RAY456", "wallet_address": "WalletB", "exit_price": 0.0005, "pnl_usd": -600.0, "ts": 1001}], "expected": {"bankroll_usd": 9400.0, "daily_pnl_usd": -600.0, "open_position_count": 0, "exposure_by_token": {}, "cooldown_active": true}}
{"case_id": "COOLDOWN_BLOCKS_ENTRY", "description": "After cooldown triggered, new entries should be blocked", "initial_bankroll": 10000.0, "params": {"max_daily_loss_usd": 500.0}, "events": [{"event_type": "entry", "signal_id": "SIG001", "token_mint": "RAY456", "wallet_address": "WalletB", "size_usd": 1000.0, "fill_price": 0.001, "ts": 1000}, {"event_type": "exit", "signal_id": "SIG001", "token_mint": "RAY456", "wallet_address": "WalletB", "exit_price": 0.0005, "pnl_usd": -600.0, "ts": 1001}, {"event_type": "entry_attempt", "signal_id": "SIG002", "token_mint": "JTO789", "wallet_address": "WalletC", "size_usd": 500.0, "fill_price": 0.002, "ts": 1002}], "expected": {"bankroll_usd": 9400.0, "daily_pnl_usd": -600.0, "open_position_count": 0, "cooldown_active": true, "entry_blocked": true}}
{"case_id": "MULTIPLE_POSITIONS", "description": "Multiple positions - check exposure tracking", "initial_bankroll": 10000.0, "params": {"max_daily_loss_usd": 500.0}, "events": [{"event_type": "entry", "signal_id": "SIG001", "token_mint": "SOL123", "wallet_address": "WalletA", "size_usd": 2000.0, "fill_price": 0.0002, "ts": 1000}, {"event_type": "entry", "signal_id": "SIG002", "token_mint": "RAY456", "wallet_address": "WalletB", "size_usd": 1500.0, "fill_price": 0.001, "ts": 1001}, {"event_type": "entry", "signal_id": "SIG003", "token_mint": "JTO789", "wallet_address": "WalletA", "size_usd": 1000.0, "fill_price": 0.002, "ts": 1002}], "expected": {"bankroll_usd": 5500.0, "open_position_count": 3, "exposure_by_token": {"SOL123": 2000.0, "RAY456": 1500.0, "JTO789": 1000.0}, "exposure_by_source_wallet": {"WalletA": 3000.0, "WalletB": 1500.0}, "cooldown_active": false}}
{"case_id": "SERIALIZATION_ROUNDTRIP", "description": "State serialization and deserialization", "initial_bankroll": 10000.0, "params": {"max_daily_loss_usd": 500.0}, "events": [{"event_type": "entry", "signal_id": "SIG001", "token_mint": "SOL123", "wallet_address": "WalletA", "size_usd": 1000.0, "fill_price": 0.0002, "ts": 1000}, {"event_type": "exit", "signal_id": "SIG001", "token_mint": "SOL123", "wallet_address": "WalletA", "exit_price": 0.00025, "pnl_usd": 250.0, "ts": 1001}], "expected": {"bankroll_usd": 10250.0, "daily_pnl_usd": 250.0, "state_dict_keys": ["bankroll_usd", "daily_pnl_usd", "open_positions", "exposure_by_token", "cooldown_active"]}}
